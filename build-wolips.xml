<?xml version="1.0"?>

<!-- ======================================================== -->
<!--                 WOLips Ant file.                         -->
<!-- ======================================================== -->
<project name="woproject-wolips" default="java" basedir=".">
	
                
    <!-- main distribution. -->
    
    <!-- ============================================= -->
    <!-- Define CLASSPATH settings.                    -->
    <!-- ============================================= -->
    <target name="defineClasspath">
        <path id="classpath">
            <fileset dir="${ant.home}/lib">
                <include name="ant.jar"/>
            </fileset>
            <fileset dir="lib">
                <include name="*.jar"/>
	            <include name="eclipse/**/*.jar"/>
            </fileset>
            <fileset dir="${wo.dir.library.frameworks}">
                <include name="JavaFoundation.framework/Resources/Java/*.jar"/>
            </fileset>
             <!-- Depends on WOProject core. -->
            <pathelement path="${build}/main"/>
        </path>
    </target>

    <target name="java" depends="prepare">
        <javac srcdir="src/wolips/java"
                destdir="${build}/wolips"
                deprecation="${compile.deprecation}"
                debug="${compile.debug}"
                optimize="${compile.optimize}">
            <classpath refid="classpath"/>
        </javac>
         
        <jar jarfile="${wolips.dist}/lib/wolips.jar">
            <fileset dir="${build}/wolips"/>
            <fileset dir="src/wolips/java">
          	    <include name="**/*.properties"/>
             </fileset>
             <fileset dir="src/wolips/java">
          	    <include name="**/*.gif"/>
             </fileset>         
            <metainf dir="doc">
                <include name="LICENSE*"/>
            </metainf>
        </jar>

        <javac srcdir="src/wolips/src-ant"
                destdir="${build}/wolips-ant"
                deprecation="${compile.deprecation}"
                debug="${compile.debug}"
                optimize="${compile.optimize}">
            <classpath refid="classpath"/>
        </javac>
         
        <jar jarfile="${wolips.dist}/lib/wolips-ant.jar">
            <fileset dir="${build}/wolips-ant"/>
            <fileset dir="src/wolips/src-ant">
          	    <include name="**/*.properties"/>
             </fileset>
             <fileset dir="src/wolips/src-ant">
          	    <include name="**/*.gif"/>
             </fileset>         
            <metainf dir="doc">
                <include name="LICENSE*"/>
            </metainf>
        </jar>
        
        <jar jarfile="${wolips.dist}/lib/woproject-wolips.jar">
            <fileset dir="${build}/main">
               <include name="org/objectstyle/woproject/pb/*.class"/>
               <include name="org/objectstyle/woproject/env/*.class"/>
            </fileset>
            <fileset dir="src/java">
               <include name="org/objectstyle/woproject/pb/*.properties"/>
	       <include name="org/objectstyle/woproject/env/*.properties"/>
            </fileset>
             <fileset dir="src/java">
          	<include name="org/objectstyle/woproject/pb/*.gif"/>
	        <include name="org/objectstyle/woproject/env/*.gif"/>
            </fileset>         
            <metainf dir="doc">
                <include name="LICENSE*"/>
            </metainf>
        </jar>
         
        <!-- Copy WOProject JAR's -->
        <copy todir="${wolips.dist}/lib">
             <fileset dir="${woproject.dist}/lib">
             	<exclude name="${lib.junit}"/>
             	<exclude name="${lib.log4j}"/>
             	<exclude name="${lib.cayenne}"/>
             	<exclude name="${lib.commons-logging}"/>
             	<exclude name="ant.jar"/>
             	<exclude name="woproject-tests.jar"/>
             </fileset>
         </copy>
         <copy file="${woproject.dist}/lib/${lib.cayenne}" tofile="${wolips.dist}/lib/cayenne.jar"/>
         <copy file="${woproject.dist}/lib/${lib.commons-logging}" tofile="${wolips.dist}/lib/commons-logging.jar"/>
         <copy file="${woproject.dist}/lib/${lib.log4j}" tofile="${wolips.dist}/lib/log4j.jar"/>
    </target>

    <target name="dist" depends="prepare,java,doc,api">
    	
    	 <copy todir="${wolips.dist}">
             <fileset dir=".">
             	<include name="build-user-home-wobuild-properties.xml"/>
             </fileset>
         </copy>
         
         <copy todir="${wolips.dist}">
             <fileset dir="src/wolips">
             	<exclude name="**/java/**"/>
             	<exclude name="**/src-ant/**"/>
             	<exclude name="**/lib/**"/>
             	<exclude name="**/xdocs/**"/>
             	<exclude name="**/docs/**"/>
             	<exclude name=".project"/>
             	<exclude name=".classpath"/>
             	<exclude name="*.html"/>
             	<exclude name="todo.txt"/>
             </fileset>
         </copy>
         
         <copy todir="${wolips.dist.base}">
             <fileset dir="src/wolips">
             	<include name="*.html"/>
             </fileset>
         </copy>
         
		 <copy todir="${wolips.dist.base}">
             <fileset dir="${wolips.dist}/doc">
             	<include name="**/install.html"/>
             </fileset>
         </copy>
        <jar jarfile="${wolips.dist}.jar">
     		<fileset dir="${wolips.dist}">
     	</fileset>
     </jar>
  
    </target>
         
         
         
    <!-- ============================================= -->
    <!-- Sets up build and distribution directories.   -->
    <!-- ============================================= -->
    <target name="prepare" depends="defineClasspath">
        <mkdir dir="${build}/wolips"/>
	<mkdir dir="${build}/wolips-ant"/>
        <mkdir dir="${wolips.dist}/lib"/>
    </target>


    <!-- ============================================= -->
    <!-- Deletes temporary files.                      -->
    <!-- ============================================= -->
    <target name="clean">
        <delete dir="${build}/wolips"/>
        <delete dir="${wolips.dist}"/>
    </target>
    
    
    <!-- ============================================= -->
    <!-- Deploys WOLips web site files in a local      -->
    <!-- directory.                                    -->
    <!-- ============================================= -->
    <target name="deploy-web" depends="prepare,site-doc" if="deploy.web"/>
    
    
    <!-- ========================================== -->
    <!-- Builds API documenatation.                 -->
    <!-- ========================================== -->
    <target name="api" depends="prepare">
    </target>
    
    
    <target name="doc" depends="prepare">
        <!-- copy all licenses inclusing ours -->
        <copy todir="${wolips.dist}/doc">
            <fileset dir="doc">
               <include name="LICENSE*"/>
            </fileset>
        </copy>
    </target>
    
    
    <target name="site-doc" depends="prepare">
    </target>
</project>
