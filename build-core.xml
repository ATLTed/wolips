<?xml version="1.0"?>

<!-- ======================================================== -->
<!--              Main core WOProject Ant build file          -->
<!-- ======================================================== -->
<project name="woproject-core" default="java" basedir=".">
	<property file="build.properties" />
    <property file="${user.home}/build.properties" />
    <property file="${user.home}/wobuild.properties"/>
<property file="default.properties" />
         

    <!-- ============================================= -->
    <!-- Derived Properties. These properties are      -->
    <!-- derived from other properties. You probably   -->
    <!-- don't want to redefine them.                  -->
    <!-- ============================================= -->
    <property name="dist" value="${dist.base}/${project.name}-${project.version}"/>
    <property name="output" value="output"/>


    <!-- ============================================= -->
    <!-- Creates WOProject distribution.               -->
    <!-- ============================================= -->
    <target name="dist" depends="prepare,java,doc,api">
         <!-- Copy source code -->
         <copy todir="${dist}/src">
             <fileset dir="src"/>
         </copy>

         <!-- Copy examples code -->
         <copy todir="${dist}/examples">
             <fileset dir="tests/wo">
             	<exclude name="**/build/**"/>
             	<exclude name="**/dist/**"/>
             	<exclude name="**/auto/**"/>
             </fileset>
         </copy>

         <tar tarfile="${dist.base}/${project.name}-src-${project.version}.tar">
             <tarfileset dir="${dist.base}">
                <include name="${project.name}-${project.version}/**"/>
                <exclude name="**/examples/**"/>
                <exclude name="**/lib/ant.jar"/>
                <exclude name="**/lib/${lib.junit}"/>
            </tarfileset>
         </tar>
         
         <gzip src="${dist.base}/${project.name}-src-${project.version}.tar"
              zipfile="${dist.base}/${project.name}-src-${project.version}.tar.gz"/>
         <delete file="${dist.base}/${project.name}-src-${project.version}.tar"/>
    </target>


    <!-- ============================================= -->
    <!-- Compiles Java classes                         -->
    <!-- ============================================= -->    
    <target name="java">
		<ant antfile="build-code.xml"/>
    </target>

    <!-- ============================================= -->
    <!-- Runs Unit tests.                              -->
    <!-- ============================================= -->
    <target name="test" depends="prepare,java">
        <ant antfile="build-test.xml"/>
    </target>
    

    <!-- ============================================= -->
    <!-- Sets up build and distribution directories.   -->
    <!-- ============================================= -->
    <target name="prepare">
        <mkdir dir="${dist}"/>
        <mkdir dir="${dist}/src"/>
        <mkdir dir="${dist}/examples"/>
    </target>


    <!-- ============================================= -->
    <!-- Deletes temporary files.                      -->
    <!-- ============================================= -->
    <target name="clean">        
        <ant antfile="build-test.xml" target="clean"/>
        <ant antfile="build-code.xml" target="clean"/>
        <ant antfile="build-doc.xml" target="clean"/>
                
        <delete dir="${dist}"/>
        <delete dir="${output}/build/main"/>
    </target>
    
    

    <!-- ========================================== -->
    <!-- Builds WOProject documenatation.           -->
    <!-- ========================================== -->
    <target name="doc">
		<ant antfile="build-doc.xml" target="doc"/>
    </target>


    <!-- ========================================== -->
    <!-- Builds API documenatation.                 -->
    <!-- ========================================== -->
    <target name="api">
		<ant antfile="build-doc.xml" target="api"/>
    </target>
    
    
    <!-- ============================================= -->
    <!-- Deploys WOProject web site in a local         -->
    <!-- directory.                                    -->
    <!-- ============================================= -->
    <target name="deploy-web" depends="java,doc,api" if="deploy.web">
		<ant antfile="build-doc.xml" target="deploy-web"/>
    </target>
</project>
