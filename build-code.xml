<?xml version="1.0"?>


<!-- ======================================================== -->
<!--          WOProject Java class compilation.               -->
<!--       Normally is called from the main build.xml.        -->
<!-- ======================================================== -->
<project name="woproject-code" default="java" basedir=".">
     	<!-- ============================================= -->
    <!-- Define CLASSPATH settings.                    -->
    <!-- ============================================= -->
    <target name="define-classpath">
        <path id="classpath">
        	<fileset dir="${ant.home}/lib">
            	<include name="ant.jar"/>
        	</fileset>
        	<fileset dir="lib">
            	<include name="**/*.jar"/>
	        	<exclude name="eclipse/**/*.jar"/>
	        	<exclude name="${lib.jmechanic}"/>
        	</fileset>
        	<fileset dir="${wo.dir.library.frameworks}">
            	<include name="JavaEOAccess.framework/Resources/Java/*.jar"/>
            	<include name="JavaEOControl.framework/Resources/Java/*.jar"/>
            	<include name="JavaFoundation.framework/Resources/Java/*.jar"/>
            	<include name="JavaWebObjects.framework/Resources/Java/*.jar"/>
            	<include name="JavaJDBCAdaptor.framework/Resources/Java/*.jar"/>
        	</fileset>
    	</path>

		<path id="classpath-tests">
    		<path refid="classpath"/>
    		<pathelement path="${woproject.dist}/lib/${woproject.name}.jar"/>
    	</path>
    </target>

    <!-- ============================================= -->
    <!-- Compiles Java classes                         -->
    <!-- ============================================= -->
    <target name="java" depends="define-classpath,java-main,java-tests"/>

    <target name="java-main" depends="prepare">
       <javac srcdir="src/java"
                destdir="${build}/main"
                deprecation="${compile.deprecation}"
                debug="${compile.debug}"
                optimize="${compile.optimize}">
            <classpath refid="classpath"/>
        </javac>

        <jar jarfile="${woproject.dist}/lib/${woproject.name}.jar">
            <fileset dir="${build}/main" />
            <fileset dir="src/resources"/>
            
            <metainf dir="doc">
                <include name="LICENSE*"/>
            </metainf>
        </jar>

        <copy todir="${woproject.dist}/lib" file="lib/${lib.cayenne}"/>
        <copy todir="${woproject.dist}/lib" file="lib/${lib.commons-logging}"/>
    </target>


    <target name="java-tests" depends="prepare,java-main">
       <javac srcdir="tests/java"
                destdir="${build}/tests"
                deprecation="${compile.deprecation}"
                debug="${compile.debug}"
                optimize="${compile.optimize}">
            <classpath refid="classpath-tests"/>
        </javac>

        <jar jarfile="${woproject.dist}/lib/${woproject.name}-tests.jar">
            <fileset dir="${build}/tests" />
            <metainf dir="doc">
                <include name="LICENSE*"/>
            </metainf>
        </jar>

        <copy todir="${woproject.dist}/lib">
        	<fileset dir="lib">
        		<include name="${lib.log4j}"/>
        		<include name="${lib.junit}"/>
        		<include name="${lib.commons-logging}"/>
        	</fileset>
        	<fileset dir="${ant.home}/lib">
        		<include name="ant.jar"/>
        	</fileset>
        </copy>
    </target>

    <!-- ============================================= -->
    <!-- Sets up build and distribution directories.   -->
    <!-- ============================================= -->
    <target name="prepare">
        <mkdir dir="${build}/main"/>
        <mkdir dir="${build}/tests"/>
        <mkdir dir="${woproject.dist}/lib"/>
    </target>


    <!-- ============================================= -->
    <!-- Deletes temporary files.                      -->
    <!-- ============================================= -->
    <target name="clean">
        <delete dir="${woproject.dist}/lib"/>
        <delete dir="${build}"/>
    </target>
</project>
