<?xml version="1.0"?>

<!-- ======================================================== -->
<!--              Main WOProject Ant build file               -->
<!-- Serves as a facade for different helper build files.     -->
<!-- ======================================================== -->
<project name="woproject" default="java" basedir=".">
	<property file="build.properties"/>
    <property file="${user.home}/build.properties"/>
    <property file="default.properties"/>

    <!-- ============================================= -->
    <!-- Derived Properties. These properties are      -->
    <!-- derived from other properties. You probably   -->
    <!-- don't want to redefine them.                  -->
    <!-- ============================================= -->
    <property name="output" value="output"/>
    
    <target name="help">
        <echo>
        ****************************************
        * TARGETS (also you can use "-projecthelp" ant flag):
        *
        *  1. help       - prints this message.
        *  2. prepare    - creates directories needed for distribution.
        *  3. java       - compiles java and webapp subprojects.
        *  4. clean      - cleans temporary directories.
        *  5. doc        - creates documentation including Javadoc.
        *  6. dist       - creates WOProject distribution.
        *  7. test       - Run JUnit tests.
        *
        *
        * Build environment:
        *
        * java.home = ${java.home}
        * build.compiler = ${build.compiler}
        * ant.home = ${ant.home}
        * user.home = ${user.home}
        *
        ****************************************
        </echo>
    </target>


    <!-- ============================================= -->
    <!-- Creates WOProject distribution.               -->
    <!-- ============================================= -->
    <target name="dist"> 
    	<ant antfile="build-core.xml" target="dist"/>
    	<ant antfile="build-wolips.xml" target="dist"/>
		<ant antfile="build-wolips-targetbuilder.xml" target="dist"/>
		<ant antfile="build-wolips-dist.xml" target="dist"/>
    </target>

    <!-- ============================================= -->
    <!-- Compiles Java classes                         -->
    <!-- ============================================= -->    
    <target name="java">
    	<ant antfile="build-core.xml" target="java"/>
    	<ant antfile="build-wolips.xml" target="java"/>
		<ant antfile="build-wolips-targetbuilder.xml" target="java"/>
    </target>


    <!-- ============================================= -->
    <!-- Runs Unit tests.                              -->
    <!-- ============================================= -->
    <target name="test">
        <ant antfile="build-core.xml" target="test"/>
    </target>


    <!-- ============================================= -->
    <!-- Deletes temporary files.                      -->
    <!-- ============================================= -->
    <target name="clean">
        <delete dir="${dist.base}"/>
        <delete dir="${output}"/>
    </target>
    
    

    <!-- ========================================== -->
    <!-- Builds WOProject documenatation.          -->
    <!-- ========================================== -->
    <target name="doc">
		<ant antfile="build-core.xml" target="doc"/>
		<ant antfile="build-wolips.xml" target="doc"/>
		<ant antfile="build-wolips-targetbuilder.xml" target="doc"/>
    </target>


    <!-- ========================================== -->
    <!-- Builds API documenatation.                 -->
    <!-- ========================================== -->
    <target name="api">
		<ant antfile="build-core.xml" target="api"/>
		<ant antfile="build-wolips.xml" target="api"/>
		<ant antfile="build-wolips-targetbuilder.xml" target="api"/>
    </target>
    
    
    <!-- ============================================= -->
    <!-- Deploys WOProject web site in a local         -->
    <!-- directory.                                    -->
    <!-- ============================================= -->
    <target name="deploy-web" depends="java,doc,api" if="deploy.web">
        <ant antfile="build-wolips.xml" target="deploy-web"/>
		<ant antfile="build-wolips-targetbuilder.xml" target="deploy-web"/>
		
		<!-- This must be the last task, since it would copy all the folders. -->
	    <ant antfile="build-core.xml" target="deploy-web"/>
    </target>
</project>
