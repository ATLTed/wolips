<?xml version="1.0"?>
 
<!-- ======================================================== -->
<!--              Main WOLips Ant build file                  -->
<!-- Serves as a facade for different helper build files.     -->
<!-- ======================================================== -->
<project name="wolips" default="" basedir=".">

    <!-- ========================================== -->
    <!-- Verify eclipse.home.                       -->
    <!-- ========================================== -->
    <target name="verify">
        <condition property="eclipse.home.set">
            <isset property="eclipse.home"/>
        </condition>
        <condition property="eclipse.home.not.set">
            <not>
                <isset property="eclipse.home"/>
            </not>
        </condition>
    </target>

    <!-- ========================================== -->
    <!-- Inform user.                               -->
    <!-- ========================================== -->
    <target name="inform_user" if="eclipse.home.not.set">
        <echo message="Please set the property eclipse.home in your build.properties to build wolips and run unit tests against it."/>
    </target>

    <!-- ========================================== -->
    <!-- Build all children.                        -->
    <!-- ========================================== -->
    <target name="all_children" if="eclipse.home.set">
	<ant dir="plugins" target="all"/>
	<ant dir="features" target="all"/>
    </target>

    <!-- ========================================== -->
    <!-- Build all.                                 -->
    <!-- ========================================== -->
    <target name="all" depends="verify,all_children,inform_user">
    	<copy file="update/local/site.xml" todir="../${build.output.build.dir}"/>
        <replace file="../${build.output.build.dir}/site.xml" token="${build.version.to.replace}" value="${build.version}"/>
    </target>

    <!-- ========================================== -->
    <!-- Build dist children.                       -->
    <!-- ========================================== -->
    <target name="dist_children" if="EclipseHomeSet">
	    <ant dir="plugins" target="dist"/>
	    <ant dir="features" target="dist"/>
    </target>

    <!-- ============================================= -->
    <!-- Run tests.                                    -->
    <!-- ============================================= -->
    <target name="test" depends="verify,test.launch">
    </target>

    <!-- ============================================= -->
    <!-- Run tests.                                    -->
    <!-- ============================================= -->
    <target name="test.launch"  if="eclipse.home.set">
        <ant dir="plugins" target="test"/>
	</target>

    <!-- ========================================== -->
    <!-- Build dist.                                -->
    <!-- ========================================== -->
    <target name="dist" depends="verify,dist_children,inform_user">
    </target>

</project>
